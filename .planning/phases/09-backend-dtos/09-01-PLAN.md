---
phase: 09-backend-dtos
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - backend/src/DTO/Response/TagResponse.php
  - backend/src/DTO/Response/EventResponse.php
  - backend/src/DTO/Response/NoteResponse.php
  - backend/src/DTO/Response/JournalEntryResponse.php
autonomous: true
user_setup: []

must_haves:
  truths:
    - "TagResponse::fromEntity() produces correct JSON structure"
    - "EventResponse::fromEntity() produces correct JSON structure"
    - "NoteResponse::fromEntity() produces correct JSON structure"
    - "All DTOs are readonly and immutable"
  artifacts:
    - path: "backend/src/DTO/Response/TagResponse.php"
      provides: "Tag serialization"
      exports: ["TagResponse"]
    - path: "backend/src/DTO/Response/EventResponse.php"
      provides: "Event serialization"
      exports: ["EventResponse"]
    - path: "backend/src/DTO/Response/NoteResponse.php"
      provides: "Note serialization"
      exports: ["NoteResponse"]
    - path: "backend/src/DTO/Response/JournalEntryResponse.php"
      provides: "JournalEntry serialization"
      exports: ["JournalEntryResponse"]
  key_links:
    - from: "TagResponse"
      to: "App\\Entity\\Tag"
      via: "fromEntity() static factory"
    - from: "EventResponse"
      to: "App\\Entity\\Event"
      via: "fromEntity() static factory"
---

<objective>
Create base Response DTO classes for Tag, Event, Note, and JournalEntry entities.

Purpose: These are leaf DTOs with no dependencies on other Response DTOs. They serve as building blocks for more complex DTOs (TaskResponse, TimeBlockResponse, DailyNoteResponse).

Output: Four readonly DTO classes in `backend/src/DTO/Response/` with `fromEntity()` static factory methods.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-backend-dtos/09-RESEARCH.md

Existing serialization patterns to match:
- EventController.php lines 74-80 (create), 122-128 (update)
- BrainDumpFacade.php lines 262-268 (events), 272-277 (notes)
- NoteController.php lines 149-159 (serializeNote)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DTO directory structure and TagResponse</name>
  <files>
    backend/src/DTO/Response/TagResponse.php
  </files>
  <action>
Create directory `backend/src/DTO/Response/` if not exists.

Create TagResponse DTO with fields matching existing inline serialization:
- id: int
- name: string
- color: string

Use `final readonly class` pattern with constructor property promotion.
Add static `fromEntity(Tag $tag): self` factory method.

Match existing format from TaskController line 201-205:
```php
'tags' => array_map(fn ($tag) => [
    'id' => $tag->getId(),
    'name' => $tag->getName(),
    'color' => $tag->getColor(),
], $task->getTags()->toArray()),
```
  </action>
  <verify>File exists and contains readonly class with fromEntity method. Run `docker compose exec php php -l backend/src/DTO/Response/TagResponse.php` for syntax check.</verify>
  <done>TagResponse DTO exists with id, name, color fields and fromEntity() factory.</done>
</task>

<task type="auto">
  <name>Task 2: Create EventResponse DTO</name>
  <files>
    backend/src/DTO/Response/EventResponse.php
  </files>
  <action>
Create EventResponse DTO with fields matching EventController serialization:
- id: int
- title: string
- date: ?string (Y-m-d format)
- startTime: ?string (H:i format)
- endTime: ?string (H:i format)

Use `final readonly class` pattern.
Add static `fromEntity(Event $event): self` factory method.

IMPORTANT: Match existing format from EventController lines 74-80:
```php
return $this->json([
    'id' => $event->getId(),
    'title' => $event->getTitle(),
    'date' => $event->getDate()?->format('Y-m-d'),
    'startTime' => $event->getStartTime()?->format('H:i'),
    'endTime' => $event->getEndTime()?->format('H:i'),
], Response::HTTP_CREATED);
```

Note: Some responses include date, some don't (update response line 127). Use nullable date to handle both cases.
  </action>
  <verify>File exists and contains readonly class with fromEntity method. Run `docker compose exec php php -l backend/src/DTO/Response/EventResponse.php` for syntax check.</verify>
  <done>EventResponse DTO exists with id, title, date, startTime, endTime fields and fromEntity() factory.</done>
</task>

<task type="auto">
  <name>Task 3: Create NoteResponse and JournalEntryResponse DTOs</name>
  <files>
    backend/src/DTO/Response/NoteResponse.php
    backend/src/DTO/Response/JournalEntryResponse.php
  </files>
  <action>
Create NoteResponse DTO matching NoteController.serializeNote():
- id: int
- content: string
- title: ?string
- format: string
- createdAt: ?string (ISO 8601 format 'c')
- updatedAt: ?string (ISO 8601 format 'c')

Create JournalEntryResponse DTO matching BrainDumpFacade lines 280-284:
- id: int
- content: string

Both should use `final readonly class` pattern with fromEntity() static factories.

Note: BrainDumpFacade.getDailyNoteData() uses simpler Note format (id, content only) for the daily note response. The full NoteResponse will be used by NoteController. This is intentional - different use cases need different detail levels.
  </action>
  <verify>Both files exist with correct structure. Run `docker compose exec php php -l backend/src/DTO/Response/NoteResponse.php && docker compose exec php php -l backend/src/DTO/Response/JournalEntryResponse.php` for syntax check.</verify>
  <done>NoteResponse and JournalEntryResponse DTOs exist with correct fields and fromEntity() factories.</done>
</task>

</tasks>

<verification>
Run PHPStan to verify type safety:
```bash
docker compose exec php ./vendor/bin/phpstan analyse backend/src/DTO --level=6
```

Verify all DTOs follow consistent patterns:
- All classes are `final readonly class`
- All have `fromEntity()` static factory methods
- All use constructor property promotion
- All types match existing inline serialization exactly
</verification>

<success_criteria>
1. Four DTO files created in backend/src/DTO/Response/
2. Each DTO has fromEntity() static factory method
3. Field names and types match existing serialization patterns exactly
4. PHPStan passes with no errors
5. All DTOs use PHP 8.2+ readonly class syntax
</success_criteria>

<output>
After completion, create `.planning/phases/09-backend-dtos/09-01-SUMMARY.md`
</output>
