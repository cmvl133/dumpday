---
phase: 09-backend-dtos
plan: 04
type: execute
wave: 2
depends_on: ["09-01", "09-03"]
files_modified:
  - backend/src/DTO/Response/ScheduleItemResponse.php
  - backend/src/DTO/Response/DailyNoteResponse.php
autonomous: true
user_setup: []

must_haves:
  truths:
    - "ScheduleItemResponse represents AI-generated schedule items"
    - "DailyNoteResponse::fromData() produces identical JSON to getDailyNoteData()"
    - "DailyNoteResponse includes nested arrays of TaskResponse, EventResponse, etc."
  artifacts:
    - path: "backend/src/DTO/Response/ScheduleItemResponse.php"
      provides: "Schedule item serialization for planning"
      exports: ["ScheduleItemResponse"]
    - path: "backend/src/DTO/Response/DailyNoteResponse.php"
      provides: "Complete daily note response with all nested data"
      exports: ["DailyNoteResponse"]
  key_links:
    - from: "DailyNoteResponse"
      to: "TaskResponse"
      via: "tasks grouped by category"
    - from: "DailyNoteResponse"
      to: "EventResponse"
      via: "events array"
---

<objective>
Create ScheduleItemResponse for planning data and DailyNoteResponse for the complete daily note API response.

Purpose: ScheduleItemResponse standardizes the planning/generate output. DailyNoteResponse consolidates the complex 20+ field structure from BrainDumpFacade.getDailyNoteData().

Output: Two readonly DTO classes that use other Response DTOs for nested serialization.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-backend-dtos/09-RESEARCH.md

Depends on Plan 01 (TagResponse, EventResponse, NoteResponse, JournalEntryResponse) and Plan 03 (TaskResponse).

ScheduleItemResponse: Used in PlanningController.generateSchedule() - the AI returns schedule suggestions.

DailyNoteResponse: Mirrors BrainDumpFacade.getDailyNoteData() lines 178-304:
- id, date, rawContent
- tasks: { today: [], scheduled: [], someday: [], overdue: [] }
- events: []
- notes: []
- journal: []
- schedule: []
- timeBlocks: []
- createdAt, updatedAt

Note: The tasks structure groups TaskResponse[] by category. This is a complex nested structure.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ScheduleItemResponse DTO</name>
  <files>
    backend/src/DTO/Response/ScheduleItemResponse.php
  </files>
  <action>
Create ScheduleItemResponse DTO for planning/generate responses.

Looking at PlanningController.generateSchedule() and the service that produces it, schedule items contain:
- taskId: int
- suggestedTime: string (H:i format)
- duration: int (minutes)
- combinedWithEventId: ?int

This DTO represents what the AI suggests for task scheduling.

```php
namespace App\DTO\Response;

final readonly class ScheduleItemResponse
{
    public function __construct(
        public int $taskId,
        public string $suggestedTime,
        public int $duration,
        public ?int $combinedWithEventId = null,
    ) {
    }

    /**
     * Create from array (AI service returns arrays).
     * @param array{taskId: int, suggestedTime: string, duration: int, combinedWithEventId?: int|null} $data
     */
    public static function fromArray(array $data): self
    {
        return new self(
            taskId: $data['taskId'],
            suggestedTime: $data['suggestedTime'],
            duration: $data['duration'],
            combinedWithEventId: $data['combinedWithEventId'] ?? null,
        );
    }
}
```

Note: This DTO uses fromArray() instead of fromEntity() because schedule items come from AI service, not entities.
  </action>
  <verify>File exists with correct structure. Run `docker compose exec php php -l backend/src/DTO/Response/ScheduleItemResponse.php` for syntax check.</verify>
  <done>ScheduleItemResponse DTO exists with taskId, suggestedTime, duration, combinedWithEventId fields.</done>
</task>

<task type="auto">
  <name>Task 2: Create DailyNoteResponse DTO</name>
  <files>
    backend/src/DTO/Response/DailyNoteResponse.php
  </files>
  <action>
Create DailyNoteResponse DTO for the complete daily note API response.

This is the most complex DTO - it contains nested grouped data.

```php
namespace App\DTO\Response;

final readonly class DailyNoteResponse
{
    /**
     * @param array{today: array, scheduled: array, someday: array, overdue: array} $tasks
     * @param array $events
     * @param array $notes
     * @param array $journal
     * @param array $schedule
     * @param array $timeBlocks
     */
    public function __construct(
        public ?int $id,
        public string $date,
        public ?string $rawContent,
        public array $tasks,
        public array $events,
        public array $notes,
        public array $journal,
        public array $schedule,
        public array $timeBlocks,
        public ?string $createdAt,
        public ?string $updatedAt,
    ) {
    }
}
```

Note: This DTO doesn't have fromEntity() because it's assembled from multiple sources in BrainDumpFacade.getDailyNoteData(). The facade will construct it directly.

The nested arrays contain:
- tasks: grouped TaskResponse[] by category
- events: EventResponse[]
- notes: simple {id, content} arrays (not full NoteResponse)
- journal: JournalEntryResponse[]
- schedule: ScheduleBuilder output (array)
- timeBlocks: TimeBlockService output (already serialized arrays)

IMPORTANT: The facade returns this complex structure. We keep the DTO simple and let the facade handle the assembly logic. The DTO is just a typed container.
  </action>
  <verify>File exists with correct structure. Run `docker compose exec php php -l backend/src/DTO/Response/DailyNoteResponse.php` for syntax check.</verify>
  <done>DailyNoteResponse DTO exists with all fields for the complete daily note response structure.</done>
</task>

</tasks>

<verification>
Run PHPStan to verify type safety:
```bash
docker compose exec php ./vendor/bin/phpstan analyse backend/src/DTO/Response --level=6
```

Count total DTOs created:
```bash
ls -la backend/src/DTO/Response/*.php | wc -l
```
Expected: 8 files (TagResponse, EventResponse, NoteResponse, JournalEntryResponse, TaskResponse, TimeBlockResponse, ScheduleItemResponse, DailyNoteResponse)
</verification>

<success_criteria>
1. ScheduleItemResponse created with planning-specific fields
2. DailyNoteResponse created with all 11 fields matching getDailyNoteData()
3. All 8 Response DTOs now exist in backend/src/DTO/Response/
4. PHPStan passes with no errors
5. Field names match existing API responses exactly for backward compatibility
</success_criteria>

<output>
After completion, create `.planning/phases/09-backend-dtos/09-04-SUMMARY.md`
</output>
