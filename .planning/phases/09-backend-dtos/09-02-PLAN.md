---
phase: 09-backend-dtos
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - backend/src/DTO/Request/TaskCreateRequest.php
  - backend/src/DTO/Request/TaskUpdateRequest.php
autonomous: true
user_setup: []

must_haves:
  truths:
    - "TaskCreateRequest validates title is not blank"
    - "TaskCreateRequest validates date is not blank"
    - "TaskUpdateRequest allows all fields to be optional"
    - "Invalid requests return 422 with validation errors"
  artifacts:
    - path: "backend/src/DTO/Request/TaskCreateRequest.php"
      provides: "Task creation input validation"
      exports: ["TaskCreateRequest"]
    - path: "backend/src/DTO/Request/TaskUpdateRequest.php"
      provides: "Task update input validation"
      exports: ["TaskUpdateRequest"]
  key_links:
    - from: "TaskCreateRequest"
      to: "Symfony\\Component\\Validator\\Constraints"
      via: "Assert attributes"
    - from: "TaskUpdateRequest"
      to: "Symfony\\Component\\Validator\\Constraints"
      via: "Assert attributes"
---

<objective>
Create Request DTO classes for Task creation and update with Symfony validation constraints.

Purpose: Replace manual `json_decode()` and inline validation in TaskController with typed, validated DTOs using `#[MapRequestPayload]`.

Output: Two readonly DTO classes in `backend/src/DTO/Request/` with validation constraints.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-backend-dtos/09-RESEARCH.md

Current manual validation to replace (TaskController.php lines 38-46):
```php
$data = json_decode($request->getContent(), true);

if (empty($data['title']) || empty($data['date'])) {
    return $this->json([
        'error' => 'Title and date are required',
    ], Response::HTTP_BAD_REQUEST);
}
```

Fields used in create (TaskController lines 59-68):
- title (required)
- date (required)
- category (optional, enum: today/scheduled/someday)
- dueDate (optional)

Fields used in update (TaskController lines 116-178):
- isCompleted
- title
- dueDate
- reminderTime
- estimatedMinutes
- fixedTime
- canCombineWithEvents
- needsFullFocus
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DTO Request directory and TaskCreateRequest</name>
  <files>
    backend/src/DTO/Request/TaskCreateRequest.php
  </files>
  <action>
Create directory `backend/src/DTO/Request/` if not exists.

Create TaskCreateRequest DTO with validation constraints:

```php
namespace App\DTO\Request;

use Symfony\Component\Validator\Constraints as Assert;

final readonly class TaskCreateRequest
{
    public function __construct(
        #[Assert\NotBlank(message: 'Title is required')]
        #[Assert\Length(max: 500, maxMessage: 'Title cannot exceed 500 characters')]
        public string $title,

        #[Assert\NotBlank(message: 'Date is required')]
        #[Assert\Date(message: 'Invalid date format. Use YYYY-MM-DD')]
        public string $date,

        #[Assert\Choice(
            choices: ['today', 'scheduled', 'someday'],
            message: 'Invalid category. Must be one of: today, scheduled, someday'
        )]
        public ?string $category = null,

        #[Assert\Date(message: 'Invalid due date format. Use YYYY-MM-DD')]
        public ?string $dueDate = null,
    ) {
    }
}
```

IMPORTANT: Use string types for dates (not DateTime) - the research notes Symfony serializer date handling issues. Convert to DateTime in the controller/service layer.
  </action>
  <verify>File exists with correct structure. Run `docker compose exec php php -l backend/src/DTO/Request/TaskCreateRequest.php` for syntax check.</verify>
  <done>TaskCreateRequest DTO exists with NotBlank, Length, Date, and Choice constraints.</done>
</task>

<task type="auto">
  <name>Task 2: Create TaskUpdateRequest DTO</name>
  <files>
    backend/src/DTO/Request/TaskUpdateRequest.php
  </files>
  <action>
Create TaskUpdateRequest DTO for PATCH operations. ALL fields are optional since PATCH updates partial data.

```php
namespace App\DTO\Request;

use Symfony\Component\Validator\Constraints as Assert;

final readonly class TaskUpdateRequest
{
    public function __construct(
        #[Assert\Length(max: 500, maxMessage: 'Title cannot exceed 500 characters')]
        public ?string $title = null,

        public ?bool $isCompleted = null,

        #[Assert\Date(message: 'Invalid due date format. Use YYYY-MM-DD')]
        public ?string $dueDate = null,

        #[Assert\Regex(
            pattern: '/^([01]\d|2[0-3]):([0-5]\d)$/',
            message: 'Invalid time format. Use HH:MM'
        )]
        public ?string $reminderTime = null,

        #[Assert\PositiveOrZero(message: 'Estimated minutes must be zero or positive')]
        public ?int $estimatedMinutes = null,

        #[Assert\Regex(
            pattern: '/^([01]\d|2[0-3]):([0-5]\d)$/',
            message: 'Invalid time format. Use HH:MM'
        )]
        public ?string $fixedTime = null,

        public ?array $canCombineWithEvents = null,

        public ?bool $needsFullFocus = null,
    ) {
    }
}
```

Note on canCombineWithEvents: This is an array of event IDs. No validation needed beyond type check since empty array is valid.

Note on handling null vs missing: With MapRequestPayload, if a field is not sent, it gets its default value (null). If sent as null explicitly, it's also null. The controller must distinguish "clear this field" vs "don't change". Current implementation uses array_key_exists() for this - we'll handle this in the integration plan.
  </action>
  <verify>File exists with correct structure. Run `docker compose exec php php -l backend/src/DTO/Request/TaskUpdateRequest.php` for syntax check.</verify>
  <done>TaskUpdateRequest DTO exists with all optional fields and appropriate validation constraints.</done>
</task>

</tasks>

<verification>
Run PHPStan to verify type safety:
```bash
docker compose exec php ./vendor/bin/phpstan analyse backend/src/DTO/Request --level=6
```

Verify validation constraints are properly imported:
```bash
docker compose exec php php -r "require 'backend/vendor/autoload.php'; new App\DTO\Request\TaskCreateRequest('test', '2024-01-01');"
```
</verification>

<success_criteria>
1. Two DTO files created in backend/src/DTO/Request/
2. TaskCreateRequest has NotBlank constraints on title and date
3. TaskUpdateRequest has all fields optional with appropriate validation
4. Time format validation uses HH:MM regex pattern
5. PHPStan passes with no errors
6. All DTOs use PHP 8.2+ readonly class syntax
</success_criteria>

<output>
After completion, create `.planning/phases/09-backend-dtos/09-02-SUMMARY.md`
</output>
