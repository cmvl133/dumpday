---
phase: 02-schedule-visualization
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - frontend/src/components/schedule/TimeBlockBackground.tsx
  - frontend/src/components/schedule/DaySchedule.tsx
  - frontend/src/components/schedule/ScheduleExpandedModal.tsx
autonomous: true

must_haves:
  truths:
    - "Time blocks appear as colored diagonal-striped strips on the left side of schedule"
    - "Hovering a time block shows tooltip with name, times, and edit option"
    - "Time blocks render behind events (lower z-index)"
    - "Time blocks appear in both DaySchedule and ScheduleExpandedModal"
    - "Block position aligns with time grid (using calculateTopPercent/calculateHeightPercent)"
  artifacts:
    - path: "frontend/src/components/schedule/TimeBlockBackground.tsx"
      provides: "Container rendering all time blocks as background layer"
      exports: ["TimeBlockBackground"]
    - path: "frontend/src/components/schedule/DaySchedule.tsx"
      provides: "Schedule with TimeBlockBackground integrated"
      contains: "TimeBlockBackground"
    - path: "frontend/src/components/schedule/ScheduleExpandedModal.tsx"
      provides: "Expanded modal with TimeBlockBackground integrated"
      contains: "TimeBlockBackground"
  key_links:
    - from: "frontend/src/components/schedule/TimeBlockBackground.tsx"
      to: "frontend/src/components/schedule/TimeBlockStrip.tsx"
      via: "import"
      pattern: "import.*TimeBlockStrip"
    - from: "frontend/src/components/schedule/DaySchedule.tsx"
      to: "frontend/src/components/schedule/TimeBlockBackground.tsx"
      via: "import and render"
      pattern: "<TimeBlockBackground"
    - from: "frontend/src/components/schedule/ScheduleExpandedModal.tsx"
      to: "frontend/src/components/schedule/TimeBlockBackground.tsx"
      via: "import and render"
      pattern: "<TimeBlockBackground"
---

<objective>
Create TimeBlockBackground container and integrate time blocks into DaySchedule and ScheduleExpandedModal.

Purpose: Complete the schedule visualization by wiring TimeBlockStrip into the schedule views. Users will see time blocks as colored diagonal-striped strips on the left side of their schedule, with hover tooltips showing block details.

Output: Working time block visualization in both schedule views (main DaySchedule card and expanded modal).
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-schedule-visualization/02-RESEARCH.md

# Prior plan summary (required - creates TimeBlockStrip and TimeBlock type):
@.planning/phases/02-schedule-visualization/02-01-SUMMARY.md

# Source files to modify:
@frontend/src/components/schedule/DaySchedule.tsx
@frontend/src/components/schedule/ScheduleExpandedModal.tsx

# Pattern reference:
@frontend/src/lib/utils.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TimeBlockBackground container component</name>
  <files>frontend/src/components/schedule/TimeBlockBackground.tsx</files>
  <action>
Create TimeBlockBackground component that maps over timeBlocks array and renders TimeBlockStrip for each.

Implementation:
```typescript
import { useMemo } from 'react';
import { TimeBlockStrip } from './TimeBlockStrip';
import { calculateTopPercent, calculateHeightPercent } from '@/lib/utils';
import type { TimeBlock } from '@/types';

interface TimeBlockBackgroundProps {
  timeBlocks: TimeBlock[];
  onEditBlock?: (block: TimeBlock) => void;
}

export function TimeBlockBackground({
  timeBlocks,
  onEditBlock,
}: TimeBlockBackgroundProps) {
  const blocksWithLayout = useMemo(() => {
    return timeBlocks.map((block) => ({
      block,
      topPercent: calculateTopPercent(block.startTime),
      heightPercent: calculateHeightPercent(block.startTime, block.endTime),
    }));
  }, [timeBlocks]);

  return (
    <>
      {blocksWithLayout.map((item) => (
        <TimeBlockStrip
          key={item.block.id}
          block={item.block}
          topPercent={item.topPercent}
          heightPercent={item.heightPercent}
          onEdit={onEditBlock}
        />
      ))}
    </>
  );
}
```

Uses calculateTopPercent and calculateHeightPercent from @/lib/utils.ts (same functions used by events).
  </action>
  <verify>
Run `npx tsc --noEmit` from frontend/ directory.
File exists: `ls frontend/src/components/schedule/TimeBlockBackground.tsx`
  </verify>
  <done>
TimeBlockBackground.tsx exists with correct imports, useMemo for layout calculation, maps over timeBlocks rendering TimeBlockStrip for each.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate TimeBlockBackground into DaySchedule</name>
  <files>frontend/src/components/schedule/DaySchedule.tsx</files>
  <action>
Modify DaySchedule.tsx to:

1. Add import for TimeBlockBackground:
   `import { TimeBlockBackground } from './TimeBlockBackground';`

2. Add import for TimeBlock type:
   `import type { ScheduleEvent, Task, TimeBlock } from '@/types';`

3. Add timeBlocks prop to DayScheduleProps interface:
   ```typescript
   interface DayScheduleProps {
     events: ScheduleEvent[];
     scheduledTasks?: Task[];
     timeBlocks?: TimeBlock[];  // ADD THIS
     isPreview?: boolean;
     // ... rest unchanged
   }
   ```

4. Add timeBlocks to destructured props (with default empty array):
   ```typescript
   export function DaySchedule({
     events,
     scheduledTasks = [],
     timeBlocks = [],  // ADD THIS
     isPreview = false,
     // ... rest
   }: DayScheduleProps) {
   ```

5. Render TimeBlockBackground AFTER half-hour lines, BEFORE current time indicator (around line 352).
   Insert this block:
   ```tsx
   {/* Time block backgrounds */}
   {timeBlocks.length > 0 && (
     <TimeBlockBackground
       timeBlocks={timeBlocks}
     />
   )}
   ```

Placement rationale: After grid lines (visual background), before events/tasks (z-index 5 for blocks, 10 for events, 30 for tasks).

NOTE: Do not add onEditBlock handler yet - that will be added in Phase 3 when Settings UI exists. For now, blocks are view-only with hover info.
  </action>
  <verify>
Run `npx tsc --noEmit` from frontend/ directory.
Check integration: `grep -n "TimeBlockBackground" frontend/src/components/schedule/DaySchedule.tsx`
  </verify>
  <done>
DaySchedule accepts timeBlocks prop, imports TimeBlockBackground, renders it after half-hour lines and before current time indicator. Blocks appear as background layer behind events and tasks.
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate TimeBlockBackground into ScheduleExpandedModal</name>
  <files>frontend/src/components/schedule/ScheduleExpandedModal.tsx</files>
  <action>
Modify ScheduleExpandedModal.tsx to:

1. Add import for TimeBlockBackground:
   `import { TimeBlockBackground } from './TimeBlockBackground';`

2. Add import for TimeBlock type (update existing import):
   `import type { ScheduleEvent, Task, TimeBlock } from '@/types';`

3. Add timeBlocks prop to ScheduleExpandedModalProps interface:
   ```typescript
   interface ScheduleExpandedModalProps {
     isOpen: boolean;
     onClose: () => void;
     events: ScheduleEvent[];
     scheduledTasks: Task[];
     unscheduledTasks: Task[];
     timeBlocks?: TimeBlock[];  // ADD THIS
     onUpdateEvent?: (id: number, data: { ... }) => void;
     // ... rest unchanged
   }
   ```

4. Add timeBlocks to destructured props (with default empty array):
   ```typescript
   export function ScheduleExpandedModal({
     isOpen,
     onClose,
     events,
     scheduledTasks,
     unscheduledTasks,
     timeBlocks = [],  // ADD THIS
     onUpdateEvent,
     // ... rest
   }: ScheduleExpandedModalProps) {
   ```

5. Render TimeBlockBackground inside DroppableSchedule, AFTER half-hour lines, BEFORE current time indicator (around line 422).
   Insert this block:
   ```tsx
   {/* Time block backgrounds */}
   {timeBlocks.length > 0 && (
     <TimeBlockBackground
       timeBlocks={timeBlocks}
     />
   )}
   ```

This ensures consistency between the main schedule card and the expanded modal view.
  </action>
  <verify>
Run `npx tsc --noEmit` from frontend/ directory.
Check integration: `grep -n "TimeBlockBackground" frontend/src/components/schedule/ScheduleExpandedModal.tsx`
  </verify>
  <done>
ScheduleExpandedModal accepts timeBlocks prop, imports TimeBlockBackground, renders it in the same position as DaySchedule (after half-hour lines, before current time indicator). Blocks visible in expanded view.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `cd frontend && npx tsc --noEmit` passes
2. TimeBlockBackground component created
3. DaySchedule accepts and renders timeBlocks
4. ScheduleExpandedModal accepts and renders timeBlocks
5. Blocks render at correct z-index (5, behind events at 10 and tasks at 30)
</verification>

<success_criteria>
- TimeBlockBackground maps timeBlocks to TimeBlockStrip components with calculated positions
- DaySchedule renders TimeBlockBackground when timeBlocks prop provided
- ScheduleExpandedModal renders TimeBlockBackground when timeBlocks prop provided
- Time blocks appear behind events and tasks (z-index layering correct)
- TypeScript compiles without errors
- Blocks use diagonal stripe pattern from TimeBlockStrip
- Hover tooltips work on both schedule views
</success_criteria>

<output>
After completion, create `.planning/phases/02-schedule-visualization/02-02-SUMMARY.md`
</output>
