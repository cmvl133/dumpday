---
phase: 03-settings-management-ui
plan: 03
type: execute
wave: 2
depends_on: ["03-01", "03-02"]
files_modified:
  - frontend/src/components/timeblocks/TimeBlockSettings.tsx
  - frontend/src/components/settings/SettingsModal.tsx
  - frontend/src/i18n/locales/en.json
  - frontend/src/i18n/locales/pl.json
autonomous: false
user_setup: []

must_haves:
  truths:
    - "User can view list of existing TimeBlocks in Settings"
    - "User can create a new TimeBlock from Settings"
    - "User can edit an existing TimeBlock"
    - "User can delete a TimeBlock with confirmation"
    - "TimeBlock section appears in Settings modal"
    - "UI displays in user's selected language (en/pl)"
  artifacts:
    - path: "frontend/src/components/timeblocks/TimeBlockSettings.tsx"
      provides: "CRUD list UI for TimeBlocks"
      min_lines: 100
    - path: "frontend/src/components/settings/SettingsModal.tsx"
      provides: "TimeBlock section integration"
      contains: "TimeBlockSettings"
    - path: "frontend/src/i18n/locales/en.json"
      provides: "English translations"
      contains: "timeBlocks"
    - path: "frontend/src/i18n/locales/pl.json"
      provides: "Polish translations"
      contains: "timeBlocks"
  key_links:
    - from: "frontend/src/components/settings/SettingsModal.tsx"
      to: "frontend/src/components/timeblocks/TimeBlockSettings.tsx"
      via: "import and render"
      pattern: "<TimeBlockSettings"
    - from: "frontend/src/components/timeblocks/TimeBlockSettings.tsx"
      to: "frontend/src/store/timeBlockSlice.ts"
      via: "dispatch async thunks"
      pattern: "dispatch\\(.*TimeBlock"
---

<objective>
Create TimeBlockSettings CRUD list component and integrate into SettingsModal with i18n

Purpose: Complete Settings Management UI for TimeBlocks (REQ-014, REQ-015, REQ-016)
Output: TimeBlockSettings in SettingsModal, full CRUD functionality, en/pl translations
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-settings-management-ui/03-RESEARCH.md
@.planning/phases/03-settings-management-ui/03-01-SUMMARY.md
@.planning/phases/03-settings-management-ui/03-02-SUMMARY.md

# Pattern references
@frontend/src/components/tags/TagManager.tsx
@frontend/src/components/settings/SettingsModal.tsx
@frontend/src/i18n/locales/en.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add i18n translations</name>
  <files>frontend/src/i18n/locales/en.json, frontend/src/i18n/locales/pl.json</files>
  <action>
Add "timeBlocks" section to both locale files.

**en.json** - add after "tags" section:
```json
"timeBlocks": {
  "title": "Time Blocks",
  "addBlock": "Add time block",
  "editBlock": "Edit time block",
  "deleteBlock": "Delete",
  "deleteConfirm": "Delete this time block?",
  "noBlocks": "No time blocks yet",
  "manageBlocksDesc": "Create time blocks to organize your day by activity type",
  "manageBlocks": "Manage blocks",
  "name": "Name",
  "namePlaceholder": "e.g., Deep Work, Meetings",
  "color": "Color",
  "startTime": "Start time",
  "endTime": "End time",
  "recurrence": "Recurrence",
  "tags": "Associated tags",
  "tagsDesc": "Tasks with these tags fit this block",
  "noTagsSelected": "No tags selected",
  "saving": "Saving..."
}
```

**pl.json** - add after "tags" section:
```json
"timeBlocks": {
  "title": "Bloki czasowe",
  "addBlock": "Dodaj blok",
  "editBlock": "Edytuj blok",
  "deleteBlock": "Usuń",
  "deleteConfirm": "Usunąć ten blok czasowy?",
  "noBlocks": "Brak bloków czasowych",
  "manageBlocksDesc": "Twórz bloki czasowe, aby organizować dzień według typu aktywności",
  "manageBlocks": "Zarządzaj blokami",
  "name": "Nazwa",
  "namePlaceholder": "np. Praca głęboka, Spotkania",
  "color": "Kolor",
  "startTime": "Czas rozpoczęcia",
  "endTime": "Czas zakończenia",
  "recurrence": "Powtarzanie",
  "tags": "Powiązane tagi",
  "tagsDesc": "Zadania z tymi tagami pasują do tego bloku",
  "noTagsSelected": "Nie wybrano tagów",
  "saving": "Zapisuję..."
}
```

Ensure JSON remains valid after editing (no trailing commas, proper escaping).
  </action>
  <verify>
JSON syntax valid:
`cd /home/kamil/Code/dumpday/frontend && node -e "require('./src/i18n/locales/en.json'); require('./src/i18n/locales/pl.json'); console.log('JSON valid')"`
  </verify>
  <done>Both en.json and pl.json have complete timeBlocks translation keys</done>
</task>

<task type="auto">
  <name>Task 2: Create TimeBlockSettings component</name>
  <files>frontend/src/components/timeblocks/TimeBlockSettings.tsx</files>
  <action>
Create CRUD list component following TagManager.tsx pattern exactly.

Component state:
- editingBlock: TimeBlock | null (currently editing)
- showCreateForm: boolean (showing create form)
- deleteConfirmId: number | null (confirming delete for this ID)
- isSaving: boolean (loading state for create/update)

Redux integration:
- useSelector: state.timeBlocks.timeBlocks
- useDispatch: fetchTimeBlocks, createTimeBlock, updateTimeBlock, deleteTimeBlock

Lifecycle:
- useEffect: dispatch(fetchTimeBlocks()) on mount

Structure (following TagManager):
```tsx
export function TimeBlockSettings() {
  const { t } = useTranslation();
  const dispatch = useDispatch<AppDispatch>();
  const timeBlocks = useSelector((state: RootState) => state.timeBlocks.timeBlocks);
  const [isOpen, setIsOpen] = useState(false);
  const [editingBlock, setEditingBlock] = useState<TimeBlock | null>(null);
  const [showCreateForm, setShowCreateForm] = useState(false);
  const [deleteConfirmId, setDeleteConfirmId] = useState<number | null>(null);
  const [isSaving, setIsSaving] = useState(false);

  useEffect(() => {
    dispatch(fetchTimeBlocks());
  }, [dispatch]);

  const handleCreate = async (data: TimeBlockFormData) => {
    setIsSaving(true);
    try {
      await dispatch(createTimeBlock({
        name: data.name,
        color: data.color,
        startTime: data.startTime,
        endTime: data.endTime,
        recurrenceType: data.recurrenceType,
        recurrenceDays: data.recurrenceDays,
        tagIds: data.tagIds,
      })).unwrap();
      setShowCreateForm(false);
    } catch {
      // Error handling
    } finally {
      setIsSaving(false);
    }
  };

  const handleUpdate = async (data: TimeBlockFormData) => {
    if (!editingBlock) return;
    setIsSaving(true);
    try {
      await dispatch(updateTimeBlock({
        id: editingBlock.id,
        data: {
          name: data.name,
          color: data.color,
          startTime: data.startTime,
          endTime: data.endTime,
          recurrenceType: data.recurrenceType,
          recurrenceDays: data.recurrenceDays,
          tagIds: data.tagIds,
        },
      })).unwrap();
      setEditingBlock(null);
    } catch {
      // Error handling
    } finally {
      setIsSaving(false);
    }
  };

  const handleDelete = async (id: number) => {
    try {
      await dispatch(deleteTimeBlock(id)).unwrap();
      setDeleteConfirmId(null);
    } catch {
      // Error handling
    }
  };

  return (
    <Dialog open={isOpen} onOpenChange={setIsOpen}>
      <DialogTrigger asChild>
        <Button variant="outline" size="sm" className="gap-2">
          <Clock className="h-4 w-4" />
          {t('timeBlocks.manageBlocks')}
        </Button>
      </DialogTrigger>
      <DialogContent className="sm:max-w-lg">
        <DialogHeader>
          <DialogTitle className="flex items-center gap-2">
            <Clock className="h-5 w-5" />
            {t('timeBlocks.title')}
          </DialogTitle>
        </DialogHeader>

        <div className="space-y-3 mt-4 max-h-[60vh] overflow-y-auto">
          {timeBlocks.length === 0 && !showCreateForm && (
            <p className="text-sm text-muted-foreground text-center py-4">
              {t('timeBlocks.noBlocks')}
            </p>
          )}

          {/* Existing blocks */}
          {timeBlocks.map((block) => (
            <div key={block.id} className="border rounded-lg p-3">
              {editingBlock?.id === block.id ? (
                <TimeBlockForm
                  initialData={block}
                  onSave={handleUpdate}
                  onCancel={() => setEditingBlock(null)}
                  isSaving={isSaving}
                />
              ) : deleteConfirmId === block.id ? (
                <div className="space-y-2">
                  <p className="text-sm text-muted-foreground">
                    {t('timeBlocks.deleteConfirm')}
                  </p>
                  <div className="flex gap-2">
                    <Button size="sm" variant="destructive" onClick={() => handleDelete(block.id)} className="h-7">
                      {t('timeBlocks.deleteBlock')}
                    </Button>
                    <Button size="sm" variant="ghost" onClick={() => setDeleteConfirmId(null)} className="h-7">
                      {t('common.cancel')}
                    </Button>
                  </div>
                </div>
              ) : (
                <div className="flex items-start gap-3">
                  <div className="w-3 h-3 rounded-full mt-1.5" style={{ backgroundColor: block.color }} />
                  <div className="flex-1 min-w-0">
                    <div className="font-medium truncate">{block.name}</div>
                    <div className="text-sm text-muted-foreground">
                      {block.startTime} - {block.endTime}
                    </div>
                    {block.tags.length > 0 && (
                      <div className="flex flex-wrap gap-1 mt-1">
                        {block.tags.map((tag) => (
                          <span
                            key={tag.id}
                            className="px-1.5 py-0.5 rounded text-xs"
                            style={{ backgroundColor: `${tag.color}30`, color: tag.color }}
                          >
                            {tag.name}
                          </span>
                        ))}
                      </div>
                    )}
                  </div>
                  <div className="flex gap-1">
                    <Button variant="ghost" size="icon" className="h-7 w-7" onClick={() => setEditingBlock(block)}>
                      <Pencil className="h-3.5 w-3.5" />
                    </Button>
                    <Button
                      variant="ghost"
                      size="icon"
                      className="h-7 w-7 text-muted-foreground hover:text-destructive"
                      onClick={() => setDeleteConfirmId(block.id)}
                    >
                      <Trash2 className="h-3.5 w-3.5" />
                    </Button>
                  </div>
                </div>
              )}
            </div>
          ))}

          {/* Create form */}
          {showCreateForm ? (
            <div className="border rounded-lg p-3">
              <TimeBlockForm
                onSave={handleCreate}
                onCancel={() => setShowCreateForm(false)}
                isSaving={isSaving}
              />
            </div>
          ) : (
            <Button variant="outline" size="sm" className="w-full" onClick={() => setShowCreateForm(true)}>
              <Plus className="h-4 w-4 mr-2" />
              {t('timeBlocks.addBlock')}
            </Button>
          )}
        </div>
      </DialogContent>
    </Dialog>
  );
}
```

Import Clock icon from lucide-react.
Use max-w-lg for dialog (slightly wider than TagManager's max-w-md to fit form better).
  </action>
  <verify>TypeScript compiles: `cd /home/kamil/Code/dumpday/frontend && npx tsc --noEmit`</verify>
  <done>TimeBlockSettings component has full CRUD functionality with dialog UI</done>
</task>

<task type="auto">
  <name>Task 3: Integrate into SettingsModal</name>
  <files>frontend/src/components/settings/SettingsModal.tsx</files>
  <action>
Add TimeBlockSettings section to SettingsModal, after TagManager section.

1. Add import at top:
```typescript
import { TimeBlockSettings } from '@/components/timeblocks/TimeBlockSettings';
```

2. Add new section after the tags section (after the existing `</div>` that closes tags section), before the closing `</div>` of space-y-6:
```tsx
<div className="space-y-3 pt-3 border-t">
  <label className="text-sm font-medium">
    {t('timeBlocks.title')}
  </label>
  <TimeBlockSettings />
  <p className="text-xs text-muted-foreground">
    {t('timeBlocks.manageBlocksDesc')}
  </p>
</div>
```

This mirrors the tags section structure exactly.
  </action>
  <verify>
TypeScript compiles: `cd /home/kamil/Code/dumpday/frontend && npx tsc --noEmit`
App renders without errors (manual check)
  </verify>
  <done>TimeBlockSettings appears in SettingsModal under Tags section</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete TimeBlock Settings UI with CRUD operations</what-built>
  <how-to-verify>
1. Start the app: `cd /home/kamil/Code/dumpday && make dev`
2. Log in and navigate to any day view
3. Click the Settings gear icon in the header
4. Scroll to "Time Blocks" section
5. Click "Manage blocks" button
6. Verify dialog opens with empty state message
7. Click "Add time block"
8. Fill in form:
   - Name: "Deep Work"
   - Select a color (purple recommended)
   - Start time: 09:00
   - End time: 12:00
   - Recurrence: Daily
   - Select a tag (if any exist)
9. Click Save
10. Verify block appears in list with correct details
11. Click edit (pencil icon)
12. Change name to "Morning Deep Work"
13. Save and verify update
14. Click delete (trash icon)
15. Confirm deletion
16. Verify block removed
17. Change language to Polish (in settings)
18. Verify translations ("Bloki czasowe", "Dodaj blok", etc.)
  </how-to-verify>
  <resume-signal>Type "approved" if all CRUD operations work correctly, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
1. TypeScript compilation succeeds
2. TimeBlockSettings dialog opens from SettingsModal
3. Can create, read, update, delete TimeBlocks
4. Form validation prevents empty saves
5. Delete confirmation works
6. Polish translations display correctly
7. TimeBlocks appear on schedule view (visual confirmation from Phase 2)
</verification>

<success_criteria>
- REQ-014: TimeBlock settings page in Settings - DONE (section in SettingsModal)
- REQ-015: Configure recurring schedule - DONE (recurrence type + days selector)
- REQ-016: Associate tags with blocks - DONE (TimeBlockTagSelector in form)
- All CRUD operations functional
- i18n working for en/pl
</success_criteria>

<output>
After completion, create `.planning/phases/03-settings-management-ui/03-03-SUMMARY.md`
</output>
