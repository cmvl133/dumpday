---
phase: 03-settings-management-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/lib/api.ts
  - frontend/src/store/timeBlockSlice.ts
  - frontend/src/store/index.ts
autonomous: true
user_setup: []

must_haves:
  truths:
    - "TimeBlock API calls can be made from frontend"
    - "TimeBlock state is managed in Redux"
    - "CRUD operations update Redux state correctly"
  artifacts:
    - path: "frontend/src/lib/api.ts"
      provides: "timeBlock API namespace"
      contains: "timeBlock:"
    - path: "frontend/src/store/timeBlockSlice.ts"
      provides: "Redux slice for TimeBlock CRUD"
      exports: ["fetchTimeBlocks", "createTimeBlock", "updateTimeBlock", "deleteTimeBlock"]
    - path: "frontend/src/store/index.ts"
      provides: "Store registration"
      contains: "timeBlocks: timeBlockReducer"
  key_links:
    - from: "frontend/src/store/timeBlockSlice.ts"
      to: "frontend/src/lib/api.ts"
      via: "api.timeBlock calls in async thunks"
      pattern: "api\\.timeBlock\\."
---

<objective>
Add timeBlock API client and Redux slice for TimeBlock CRUD operations

Purpose: Enable frontend state management for TimeBlock templates before building UI components
Output: api.timeBlock namespace with list/create/update/delete, timeBlockSlice with async thunks
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-settings-management-ui/03-RESEARCH.md

# Pattern references
@frontend/src/lib/api.ts
@frontend/src/store/tagSlice.ts
@frontend/src/store/index.ts
@frontend/src/types/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add timeBlock namespace to api.ts</name>
  <files>frontend/src/lib/api.ts</files>
  <action>
Add timeBlock namespace to api object following the existing tag/recurring patterns.

Include these methods:
- list(): Promise<TimeBlock[]> - GET /api/time-block
- create(data): Promise<TimeBlock> - POST /api/time-block
- update(id, data): Promise<TimeBlock> - PATCH /api/time-block/{id}
- delete(id): Promise<void> - DELETE /api/time-block/{id}

Create data types following research:
```typescript
create: async (data: {
  name: string;
  color: string;
  startTime: string;
  endTime: string;
  recurrenceType?: RecurrenceType;
  recurrenceDays?: number[] | null;
  tagIds?: number[];
}): Promise<TimeBlock>

update: async (
  id: number,
  data: Partial<Omit<TimeBlock, 'id' | 'createdAt' | 'tags'>> & { tagIds?: number[] }
): Promise<TimeBlock>
```

Import TimeBlock from @/types at top of file.
Follow exact error handling pattern from tag.list, tag.create etc.
  </action>
  <verify>TypeScript compiles without errors: `cd /home/kamil/Code/dumpday/frontend && npx tsc --noEmit`</verify>
  <done>api.timeBlock namespace exists with list, create, update, delete methods</done>
</task>

<task type="auto">
  <name>Task 2: Create timeBlockSlice.ts</name>
  <files>frontend/src/store/timeBlockSlice.ts</files>
  <action>
Create Redux slice following tagSlice.ts pattern exactly.

Interface:
```typescript
interface TimeBlockState {
  timeBlocks: TimeBlock[];
  isLoading: boolean;
  error: string | null;
}
```

Async thunks (use createAsyncThunk):
- fetchTimeBlocks - calls api.timeBlock.list()
- createTimeBlock - calls api.timeBlock.create(data)
- updateTimeBlock - calls api.timeBlock.update(id, data)
- deleteTimeBlock - calls api.timeBlock.delete(id), returns id for state update

Reducers:
- clearError - sets error to null

Extra reducers pattern (copy from tagSlice):
- fetchTimeBlocks.pending -> isLoading: true, error: null
- fetchTimeBlocks.fulfilled -> isLoading: false, timeBlocks: action.payload
- fetchTimeBlocks.rejected -> isLoading: false, error: message
- createTimeBlock.fulfilled -> push to timeBlocks array
- updateTimeBlock.fulfilled -> find and replace in array
- deleteTimeBlock.fulfilled -> filter out by id

Export: default reducer, named thunks and actions
  </action>
  <verify>TypeScript compiles: `cd /home/kamil/Code/dumpday/frontend && npx tsc --noEmit`</verify>
  <done>timeBlockSlice.ts exists with all CRUD async thunks and state management</done>
</task>

<task type="auto">
  <name>Task 3: Register slice in store</name>
  <files>frontend/src/store/index.ts</files>
  <action>
1. Add import: `import timeBlockReducer from './timeBlockSlice';`
2. Add to reducer object: `timeBlocks: timeBlockReducer,`

Place import after tagReducer import.
Place reducer entry after tags entry in alphabetical order.
  </action>
  <verify>
TypeScript compiles and app starts:
`cd /home/kamil/Code/dumpday/frontend && npx tsc --noEmit`
Check Redux DevTools shows timeBlocks in state tree (optional manual verification)
  </verify>
  <done>timeBlocks slice registered in Redux store</done>
</task>

</tasks>

<verification>
1. TypeScript compilation succeeds with no errors
2. api.timeBlock has all 4 methods (list, create, update, delete)
3. timeBlockSlice exports 4 async thunks + clearError + default reducer
4. store.getState().timeBlocks exists (RootState type updated automatically)
</verification>

<success_criteria>
- api.timeBlock namespace functional
- timeBlockSlice manages TimeBlock[] state
- Slice registered in store
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-settings-management-ui/03-01-SUMMARY.md`
</output>
