---
phase: 03-settings-management-ui
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/components/timeblocks/TimeBlockForm.tsx
  - frontend/src/components/timeblocks/TimeBlockTagSelector.tsx
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User can enter block name"
    - "User can select block color from predefined palette"
    - "User can set start and end times"
    - "User can select recurrence type"
    - "User can select days of week for custom recurrence"
    - "User can select multiple tags"
  artifacts:
    - path: "frontend/src/components/timeblocks/TimeBlockForm.tsx"
      provides: "Create/edit form for TimeBlock"
      min_lines: 100
    - path: "frontend/src/components/timeblocks/TimeBlockTagSelector.tsx"
      provides: "Multi-select tag component for form"
      min_lines: 30
  key_links:
    - from: "frontend/src/components/timeblocks/TimeBlockForm.tsx"
      to: "frontend/src/components/timeblocks/TimeBlockTagSelector.tsx"
      via: "import and usage"
      pattern: "TimeBlockTagSelector"
---

<objective>
Create TimeBlockForm component with all input fields for TimeBlock CRUD

Purpose: Reusable form component for creating and editing TimeBlocks in Settings
Output: TimeBlockForm.tsx with name, color, times, recurrence, tag selection; TimeBlockTagSelector.tsx for tag multi-select
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-settings-management-ui/03-RESEARCH.md

# Pattern references
@frontend/src/components/tags/TagManager.tsx
@frontend/src/components/tasks/RecurringSettings.tsx
@frontend/src/types/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TimeBlockTagSelector component</name>
  <files>frontend/src/components/timeblocks/TimeBlockTagSelector.tsx</files>
  <action>
Create directory frontend/src/components/timeblocks/ if it doesn't exist.

Create TimeBlockTagSelector.tsx - a multi-select tag component for forms (not popover-based like TagSelector).

Interface:
```typescript
interface TimeBlockTagSelectorProps {
  selectedTagIds: number[];
  onChange: (tagIds: number[]) => void;
}
```

Implementation:
1. Use useSelector to get tags from state.tags.tags
2. Render tags as toggle buttons (similar to TagBadge style)
3. Selected tags: full opacity, border highlight
4. Unselected tags: 50% opacity, hover: 100% opacity
5. Click toggles selection (add/remove from selectedTagIds)
6. Use getContrastColor for text color (import from existing utils or inline)

Styling pattern from research:
```tsx
<div className="flex flex-wrap gap-1.5">
  {tags.map((tag) => (
    <button
      key={tag.id}
      type="button"
      onClick={() => toggleTag(tag.id)}
      className={cn(
        "px-2 py-0.5 rounded-full text-xs font-medium transition-all",
        selectedTagIds.includes(tag.id)
          ? "opacity-100 ring-1 ring-white/50"
          : "opacity-50 hover:opacity-100"
      )}
      style={{
        backgroundColor: tag.color,
        color: getContrastColor(tag.color),
      }}
    >
      {tag.name}
    </button>
  ))}
</div>
```

Include getContrastColor helper inline or import from existing utility:
```typescript
const getContrastColor = (hexColor: string): string => {
  const r = parseInt(hexColor.slice(1, 3), 16);
  const g = parseInt(hexColor.slice(3, 5), 16);
  const b = parseInt(hexColor.slice(5, 7), 16);
  const luminance = (0.299 * r + 0.587 * g + 0.114 * b) / 255;
  return luminance > 0.5 ? '#000000' : '#ffffff';
};
```

If no tags exist, show muted text: "No tags available"
  </action>
  <verify>TypeScript compiles: `cd /home/kamil/Code/dumpday/frontend && npx tsc --noEmit`</verify>
  <done>TimeBlockTagSelector renders tag toggle buttons with proper selection state</done>
</task>

<task type="auto">
  <name>Task 2: Create TimeBlockForm component</name>
  <files>frontend/src/components/timeblocks/TimeBlockForm.tsx</files>
  <action>
Create comprehensive form component for TimeBlock create/edit.

Interface:
```typescript
interface TimeBlockFormProps {
  initialData?: TimeBlock;
  onSave: (data: TimeBlockFormData) => void;
  onCancel: () => void;
  isSaving?: boolean;
}

interface TimeBlockFormData {
  name: string;
  color: string;
  startTime: string;      // "HH:MM"
  endTime: string;        // "HH:MM"
  recurrenceType: RecurrenceType;
  recurrenceDays: number[] | null;
  tagIds: number[];
}
```

Form state:
- name: string (required, min 1 char)
- color: string (default to first BLOCK_COLORS)
- startTime: string (required)
- endTime: string (required)
- recurrenceType: RecurrenceType (default 'daily')
- customDays: number[] (for 'custom' recurrence, default [1,2,3,4,5] weekdays)
- selectedTagIds: number[]

BLOCK_COLORS constant (from TimeBlockController.php ALLOWED_COLORS):
```typescript
const BLOCK_COLORS = [
  '#ef4444', '#f97316', '#f59e0b', '#eab308',
  '#84cc16', '#22c55e', '#10b981', '#14b8a6',
  '#06b6d4', '#0ea5e9', '#3b82f6', '#6366f1',
  '#8b5cf6', '#a855f7', '#d946ef', '#ec4899',
  '#f43f5e', '#78716c',
];
```

Form sections:
1. **Name input** - Input with placeholder (use t('timeBlocks.namePlaceholder') when i18n added later)
2. **Color picker** - Grid of color buttons, selected shows ring (copy TagManager pattern exactly)
3. **Time inputs** - Two native time inputs side by side
4. **Recurrence type** - Grid of buttons (copy RecurringSettings RECURRENCE_OPTIONS pattern)
5. **Custom days** - Show only when recurrenceType === 'custom', use DAY_KEYS pattern from RecurringSettings
6. **Tag selector** - TimeBlockTagSelector component
7. **Action buttons** - Save and Cancel

Form layout:
```tsx
<div className="space-y-4">
  {/* Name */}
  <div className="space-y-1.5">
    <label className="text-sm font-medium">Name</label>
    <Input value={name} onChange={(e) => setName(e.target.value)} placeholder="e.g., Deep Work, Meetings" />
  </div>

  {/* Color */}
  <div className="space-y-1.5">
    <label className="text-sm font-medium">Color</label>
    <div className="flex gap-1 flex-wrap">
      {BLOCK_COLORS.map((c) => (
        <button key={c} type="button" onClick={() => setColor(c)} className={cn(...)} style={{ backgroundColor: c }} />
      ))}
    </div>
  </div>

  {/* Times */}
  <div className="grid grid-cols-2 gap-3">
    <div className="space-y-1.5">
      <label className="text-sm font-medium">Start time</label>
      <input type="time" value={startTime} onChange={(e) => setStartTime(e.target.value)} className="..." />
    </div>
    <div className="space-y-1.5">
      <label className="text-sm font-medium">End time</label>
      <input type="time" value={endTime} onChange={(e) => setEndTime(e.target.value)} className="..." />
    </div>
  </div>

  {/* Recurrence */}
  ... (RecurringSettings pattern)

  {/* Custom days */}
  {recurrenceType === 'custom' && (
    ... (RecurringSettings day toggle pattern)
  )}

  {/* Tags */}
  <div className="space-y-1.5">
    <label className="text-sm font-medium">Associated tags</label>
    <TimeBlockTagSelector selectedTagIds={selectedTagIds} onChange={setSelectedTagIds} />
    <p className="text-xs text-muted-foreground">Tasks with these tags fit this block</p>
  </div>

  {/* Actions */}
  <div className="flex gap-2 pt-2">
    <Button onClick={handleSave} disabled={!name.trim() || !startTime || !endTime || isSaving}>
      {isSaving ? 'Saving...' : 'Save'}
    </Button>
    <Button variant="ghost" onClick={onCancel}>Cancel</Button>
  </div>
</div>
```

handleSave constructs TimeBlockFormData and calls onSave.
Use translations for labels when i18n keys added (Plan 03-03).
For now, use English literals - translations will be wired in 03-03.

Initialize from initialData if provided (edit mode):
- Parse tags to get selectedTagIds: initialData.tags.map(t => t.id)
- Set all other fields from initialData
  </action>
  <verify>TypeScript compiles: `cd /home/kamil/Code/dumpday/frontend && npx tsc --noEmit`</verify>
  <done>TimeBlockForm renders all fields and constructs valid TimeBlockFormData on save</done>
</task>

</tasks>

<verification>
1. TypeScript compilation succeeds
2. TimeBlockTagSelector renders tag toggle buttons
3. TimeBlockForm has all fields: name, color, times, recurrence, days, tags
4. Form properly validates (name, startTime, endTime required)
5. initialData correctly populates form for edit mode
</verification>

<success_criteria>
- TimeBlockForm component functional with all TimeBlock fields
- TimeBlockTagSelector enables multi-tag selection
- Forms use existing UI patterns (shadcn/ui, Tailwind)
- Components ready for integration in TimeBlockSettings
</success_criteria>

<output>
After completion, create `.planning/phases/03-settings-management-ui/03-02-SUMMARY.md`
</output>
