---
phase: 05-task-block-matching
plan: 03
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - frontend/src/types/index.ts
  - frontend/src/components/tasks/TaskBlock.tsx
  - frontend/src/i18n/locales/en.json
  - frontend/src/i18n/locales/pl.json
autonomous: true

must_haves:
  truths:
    - "Tasks with a matching block show a visual indicator (colored dot)"
    - "Hovering the indicator shows block name tooltip"
    - "Tasks without matching blocks show no indicator"
    - "New UI strings are translated in both English and Polish"
  artifacts:
    - path: "frontend/src/types/index.ts"
      provides: "Task type with matchingBlock field"
      contains: "matchingBlock"
    - path: "frontend/src/components/tasks/TaskBlock.tsx"
      provides: "Visual block indicator component"
      contains: "matchingBlock"
    - path: "frontend/src/i18n/locales/en.json"
      provides: "English translations for block matching"
      contains: "belongsToBlock"
    - path: "frontend/src/i18n/locales/pl.json"
      provides: "Polish translations for block matching"
      contains: "belongsToBlock"
  key_links:
    - from: "frontend/src/components/tasks/TaskBlock.tsx"
      to: "frontend/src/types/index.ts"
      via: "Task type import"
      pattern: "matchingBlock"
---

<objective>
Add visual indicator for task-block association to TaskBlock component and add i18n translations.

Purpose: Users can see at a glance which time block a task belongs to, providing visual feedback on the tag-based matching.

Output: TaskBlock shows colored dot for matching block, with tooltip showing block name. All strings translated.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-task-block-matching/05-RESEARCH.md
@.planning/phases/05-task-block-matching/05-01-SUMMARY.md

# Existing patterns
@frontend/src/types/index.ts
@frontend/src/components/tasks/TaskBlock.tsx
@frontend/src/i18n/locales/en.json
@frontend/src/i18n/locales/pl.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update Task type with matchingBlock field</name>
  <files>frontend/src/types/index.ts</files>
  <action>
Add matchingBlock field to Task interface.

Find the Task interface and add:
```typescript
matchingBlock?: {
  id: number;
  name: string;
  color: string;
} | null;
```

Also check if PlanningTask type exists and extends Task. If PlanningTask is separate, add matchingBlock there too.

The field is optional and nullable because:
- Tasks without matching tags will have null
- Existing task data won't have this field until fetched from updated API
  </action>
  <verify>`npm run type-check` in frontend directory passes (or `npx tsc --noEmit`)</verify>
  <done>Task and/or PlanningTask types include matchingBlock field</done>
</task>

<task type="auto">
  <name>Task 2: Add block indicator to TaskBlock component</name>
  <files>frontend/src/components/tasks/TaskBlock.tsx</files>
  <action>
Add visual indicator showing the matching block.

1. Import useTranslation if not already: `import { useTranslation } from 'react-i18next';`

2. Check component props - it receives a task. Access `task.matchingBlock`.

3. Add the visual indicator inside the component, positioned on the left side of the task:
```tsx
{task.matchingBlock && (
  <div
    className="absolute -left-1 top-1/2 -translate-y-1/2 w-2 h-2 rounded-full border border-white/50"
    style={{ backgroundColor: task.matchingBlock.color }}
    title={t('tasks.belongsToBlock', { block: task.matchingBlock.name })}
  />
)}
```

Alternative positions if -left-1 doesn't work well with existing layout:
- Use `left-1` and position inside the task
- Or add a small colored border-left instead of dot

The indicator should be:
- Small (w-2 h-2 = 8x8px)
- Colored with the block's color
- Have a tooltip showing "In: {block name}" or similar
- Not interfere with task click/interaction

Note: Check existing TaskBlock layout to find the best position. The component likely has relative positioning on parent container.
  </action>
  <verify>
Visual check: Create a task with tags that match a time block, verify dot appears with correct color.
Frontend builds without errors: `npm run build` in frontend directory.
  </verify>
  <done>TaskBlock shows colored dot indicator for tasks with matching blocks</done>
</task>

<task type="auto">
  <name>Task 3: Add i18n translations for block matching</name>
  <files>
frontend/src/i18n/locales/en.json
frontend/src/i18n/locales/pl.json
  </files>
  <action>
Add translations for block matching UI strings.

In en.json, add to "tasks" section:
```json
"belongsToBlock": "In: {{block}}",
"suggestedBlock": "Suggested: {{block}}",
"noBlockMatch": "No matching block"
```

In pl.json, add to "tasks" section:
```json
"belongsToBlock": "W: {{block}}",
"suggestedBlock": "Sugerowany: {{block}}",
"noBlockMatch": "Brak pasujacego bloku"
```

Notes:
- "belongsToBlock" is for the tooltip when hovering over block indicator
- "suggestedBlock" is for AI suggestions in brain dump preview (future use)
- "noBlockMatch" might be useful for explicit "no match" scenarios

Keep translations concise - they appear in tooltips and small UI elements.
  </action>
  <verify>Run frontend and check that translations load: browser console shows no missing translation warnings</verify>
  <done>Both locale files have block matching translations</done>
</task>

</tasks>

<verification>
1. `npm run build` passes in frontend directory
2. `npm run type-check` or `npx tsc --noEmit` passes
3. TaskBlock shows colored dot for tasks with matchingBlock
4. Tooltip shows translated "In: {block name}"
5. Tasks without matching block show no indicator
6. No missing translation warnings in console
</verification>

<success_criteria>
- Task type updated with matchingBlock field
- TaskBlock component shows visual indicator (colored dot) when task has matching block
- Indicator positioned subtly, doesn't interfere with task interaction
- Tooltip shows block name on hover
- All new strings translated in en.json and pl.json
- No TypeScript errors, build passes
</success_criteria>

<output>
After completion, create `.planning/phases/05-task-block-matching/05-03-SUMMARY.md`
</output>
