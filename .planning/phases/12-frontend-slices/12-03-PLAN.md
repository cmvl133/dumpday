---
phase: 12-frontend-slices
plan: 03
type: execute
wave: 2
depends_on: ["12-01", "12-02"]
files_modified:
  - frontend/src/store/index.ts
  - frontend/src/store/dailyNoteSlice.ts
  - frontend/src/components/how-are-you/CheckInFlow.tsx
  - frontend/src/components/how-are-you/PlanningFlow.tsx
  - frontend/src/components/how-are-you/RebuildFlow.tsx
autonomous: true

must_haves:
  truths:
    - "Store includes new flow slices"
    - "dailyNoteSlice imports performTaskAction from checkInFlowSlice"
    - "Flow components import from their dedicated slices"
    - "All existing functionality works"
  artifacts:
    - path: "frontend/src/store/index.ts"
      provides: "Updated store configuration"
      contains: "checkInFlowReducer"
    - path: "frontend/src/store/dailyNoteSlice.ts"
      provides: "Updated cross-slice import"
      contains: "from './checkInFlowSlice'"
  key_links:
    - from: "frontend/src/store/dailyNoteSlice.ts"
      to: "frontend/src/store/checkInFlowSlice.ts"
      via: "imports performTaskAction"
      pattern: "import.*performTaskAction.*from.*checkInFlowSlice"
    - from: "frontend/src/components/how-are-you/CheckInFlow.tsx"
      to: "frontend/src/store/checkInFlowSlice.ts"
      via: "imports CheckIn actions"
      pattern: "from.*checkInFlowSlice"
---

<objective>
Integrate new flow slices into store and update all component imports.

Purpose: Wire up the new slice structure and ensure all components use the correct imports. Delete unused duplicate slices.

Output:
- Updated store/index.ts with new flow slices
- Updated dailyNoteSlice.ts with new performTaskAction import
- Updated flow components with new imports
- Deleted unused checkInSlice.ts and planningSlice.ts
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-frontend-slices/12-RESEARCH.md

# Prior plan summaries needed for import paths
@.planning/phases/12-frontend-slices/12-01-SUMMARY.md
@.planning/phases/12-frontend-slices/12-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update store configuration</name>
  <files>frontend/src/store/index.ts</files>
  <action>
Update store/index.ts to include new flow slices:

1. Add imports for new slices:
   ```typescript
   import checkInFlowReducer from './checkInFlowSlice';
   import planningFlowReducer from './planningFlowSlice';
   import rebuildFlowReducer from './rebuildFlowSlice';
   ```

2. Remove imports for OLD unused slices:
   - Remove: import checkInReducer from './checkInSlice';
   - Remove: import planningReducer from './planningSlice';

3. Update reducer configuration:
   - Remove: checkIn: checkInReducer
   - Remove: planning: planningReducer
   - Add: checkInFlow: checkInFlowReducer
   - Add: planningFlow: planningFlowReducer
   - Add: rebuildFlow: rebuildFlowReducer
   - Keep: howAreYou: howAreYouReducer (coordinator)

Final reducer object should include:
- health, dailyNote, auth, settings
- howAreYou (coordinator)
- checkInFlow, planningFlow, rebuildFlow (new flow slices)
- recurring, tags, timeBlocks
  </action>
  <verify>TypeScript check: `cd /home/kamil/Code/dumpday/frontend && npx tsc --noEmit 2>&1 | grep -E "index.ts|error" | head -10`</verify>
  <done>store/index.ts updated with new slice imports and reducer configuration</done>
</task>

<task type="auto">
  <name>Task 2: Update dailyNoteSlice cross-slice import and component imports</name>
  <files>
    frontend/src/store/dailyNoteSlice.ts
    frontend/src/components/how-are-you/CheckInFlow.tsx
    frontend/src/components/how-are-you/PlanningFlow.tsx
    frontend/src/components/how-are-you/RebuildFlow.tsx
  </files>
  <action>
Update imports across multiple files:

**1. dailyNoteSlice.ts (CRITICAL - cross-slice dependency):**
- Change line 4 from:
  `import { performTaskAction } from './howAreYouSlice';`
  to:
  `import { performTaskAction } from './checkInFlowSlice';`

**2. CheckInFlow.tsx:**
- Keep imports from howAreYouSlice: backToSelection, closeModal
- Move to checkInFlowSlice: fetchCheckInTasks, performTaskAction, completeCheckIn, nextTask (was nextCheckInTask), incrementCombo, resetCombo, incrementStat

Updated imports:
```typescript
import {
  backToSelection,
  closeModal,
} from '@/store/howAreYouSlice';
import {
  fetchCheckInTasks,
  performTaskAction,
  completeCheckIn,
  nextTask,
  incrementCombo,
  resetCombo,
  incrementStat,
} from '@/store/checkInFlowSlice';
```

- Update selector: `state.howAreYou.checkIn` -> `state.checkInFlow`
- Keep error selector: `state.howAreYou.error` (still on coordinator)

**3. PlanningFlow.tsx:**
- Keep imports from howAreYouSlice: backToSelection, closeModal
- Move to planningFlowSlice: fetchPlanningTasks, nextStep (was nextPlanningStep), previousStep (was previousPlanningStep), nextTask (was nextPlanningTask), skipTask (was skipPlanningTask), setEstimation, setFixedTime, setCombineEvents, setNeedsFullFocus, markTaskPlanned, generateSchedule, acceptSchedule, savePlanningTask, resolveConflict, nextConflict, finishConflictPhase

Updated imports:
```typescript
import {
  backToSelection,
  closeModal,
} from '@/store/howAreYouSlice';
import {
  fetchPlanningTasks,
  nextStep,
  previousStep,
  nextTask,
  skipTask,
  setEstimation,
  setFixedTime,
  setCombineEvents,
  setNeedsFullFocus,
  markTaskPlanned,
  generateSchedule,
  acceptSchedule,
  savePlanningTask,
  resolveConflict,
  nextConflict,
  finishConflictPhase,
} from '@/store/planningFlowSlice';
```

- Update selector: `state.howAreYou.planning` -> `state.planningFlow`
- Keep error selector: `state.howAreYou.error`

**4. RebuildFlow.tsx:**
- Keep imports from howAreYouSlice: backToSelection, closeModal
- Move to rebuildFlowSlice: fetchRebuildData, setStep (was setRebuildStep), toggleTaskSelection, toggleEventSelection, setAdditionalInput, setWorkUntilTime, generateRebuild, acceptRebuild

Updated imports:
```typescript
import {
  backToSelection,
  closeModal,
} from '@/store/howAreYouSlice';
import {
  fetchRebuildData,
  setStep,
  toggleTaskSelection,
  toggleEventSelection,
  setAdditionalInput,
  setWorkUntilTime,
  generateRebuild,
  acceptRebuild,
} from '@/store/rebuildFlowSlice';
```

- Update selector: `state.howAreYou.rebuild` -> `state.rebuildFlow`
- Keep error selector: `state.howAreYou.error`
  </action>
  <verify>
1. TypeScript check: `cd /home/kamil/Code/dumpday/frontend && npx tsc --noEmit 2>&1 | grep -E "error|Error" | head -20`
2. Check import update: `grep -n "checkInFlowSlice" /home/kamil/Code/dumpday/frontend/src/store/dailyNoteSlice.ts`
  </verify>
  <done>All imports updated: dailyNoteSlice uses checkInFlowSlice for performTaskAction, flow components use their respective flow slices</done>
</task>

<task type="auto">
  <name>Task 3: Delete unused slices and verify build</name>
  <files>
    frontend/src/store/checkInSlice.ts (delete)
    frontend/src/store/planningSlice.ts (delete)
  </files>
  <action>
1. Delete unused duplicate slices:
   - rm frontend/src/store/checkInSlice.ts
   - rm frontend/src/store/planningSlice.ts

2. Search for any remaining references and fix if found:
   - grep -r "checkInSlice" frontend/src/
   - grep -r "planningSlice" frontend/src/

3. Also delete the old CheckInModal and PlanningModal if they exist and are unused:
   - Check: ls frontend/src/components/check-in/CheckInModal.tsx
   - Check: ls frontend/src/components/planning/PlanningModal.tsx
   - If they import from deleted slices, either delete them or update imports

4. Run full build to verify:
   - cd frontend && npm run build
  </action>
  <verify>
1. Files deleted: `ls /home/kamil/Code/dumpday/frontend/src/store/checkInSlice.ts 2>&1` should show "No such file"
2. No dangling imports: `grep -r "from.*checkInSlice" /home/kamil/Code/dumpday/frontend/src/ 2>/dev/null | wc -l` should be 0
3. Build succeeds: `cd /home/kamil/Code/dumpday/frontend && npm run build 2>&1 | tail -5`
  </verify>
  <done>Unused slices deleted, no dangling imports, build passes</done>
</task>

</tasks>

<verification>
1. `npm run build` in frontend completes successfully
2. `grep -r "performTaskAction" frontend/src/store/dailyNoteSlice.ts` shows import from checkInFlowSlice
3. No references to deleted checkInSlice.ts or planningSlice.ts remain
4. RootState type includes checkInFlow, planningFlow, rebuildFlow keys
</verification>

<success_criteria>
- Store configured with new flow slices
- dailyNoteSlice cross-slice dependency updated
- All flow components use new slice imports
- Unused duplicate slices deleted
- Frontend builds successfully
- Manual testing: CheckIn, Planning, Rebuild flows all work
</success_criteria>

<output>
After completion, create `.planning/phases/12-frontend-slices/12-03-SUMMARY.md`
</output>
