---
phase: 12-frontend-slices
plan: 03
type: execute
wave: 2
depends_on: ["12-01", "12-02"]
files_modified:
  - frontend/src/store/index.ts
  - frontend/src/store/dailyNoteSlice.ts
  - frontend/src/store/howAreYouSlice.ts
  - frontend/src/components/how-are-you/CheckInFlow.tsx
  - frontend/src/components/how-are-you/PlanningFlow.tsx
  - frontend/src/components/how-are-you/RebuildFlow.tsx
  - frontend/src/components/check-in/CheckInModal.tsx
  - frontend/src/components/planning/PlanningModal.tsx
  - frontend/src/hooks/useAutoCheckIn.ts
autonomous: true

must_haves:
  truths:
    - "Store includes new flow slices"
    - "dailyNoteSlice imports performTaskAction from checkInFlowSlice"
    - "Flow components import from their dedicated slices"
    - "All existing functionality works"
  artifacts:
    - path: "frontend/src/store/index.ts"
      provides: "Updated store configuration"
      contains: "checkInFlowReducer"
    - path: "frontend/src/store/dailyNoteSlice.ts"
      provides: "Updated cross-slice import"
      contains: "from './checkInFlowSlice'"
  key_links:
    - from: "frontend/src/store/dailyNoteSlice.ts"
      to: "frontend/src/store/checkInFlowSlice.ts"
      via: "imports performTaskAction"
      pattern: "import.*performTaskAction.*from.*checkInFlowSlice"
    - from: "frontend/src/components/how-are-you/CheckInFlow.tsx"
      to: "frontend/src/store/checkInFlowSlice.ts"
      via: "imports CheckIn actions"
      pattern: "from.*checkInFlowSlice"
---

<objective>
Integrate new flow slices into store and update all component imports.

Purpose: Wire up the new slice structure and ensure all components use the correct imports. Delete unused duplicate slices.

Output:
- Updated store/index.ts with new flow slices
- Updated dailyNoteSlice.ts with new performTaskAction import
- Updated flow components with new imports
- Updated or deleted CheckInModal.tsx and PlanningModal.tsx (currently import from old slices)
- Deleted unused checkInSlice.ts and planningSlice.ts
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-frontend-slices/12-RESEARCH.md

# Prior plan summaries needed for import paths
@.planning/phases/12-frontend-slices/12-01-SUMMARY.md
@.planning/phases/12-frontend-slices/12-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update store configuration</name>
  <files>frontend/src/store/index.ts</files>
  <action>
Update store/index.ts to include new flow slices:

1. Add imports for new slices:
   ```typescript
   import checkInFlowReducer from './checkInFlowSlice';
   import planningFlowReducer from './planningFlowSlice';
   import rebuildFlowReducer from './rebuildFlowSlice';
   ```

2. Remove imports for OLD unused slices:
   - Remove: import checkInReducer from './checkInSlice';
   - Remove: import planningReducer from './planningSlice';

3. Update reducer configuration:
   - Remove: checkIn: checkInReducer
   - Remove: planning: planningReducer
   - Add: checkInFlow: checkInFlowReducer
   - Add: planningFlow: planningFlowReducer
   - Add: rebuildFlow: rebuildFlowReducer
   - Keep: howAreYou: howAreYouReducer (coordinator)

Final reducer object should include:
- health, dailyNote, auth, settings
- howAreYou (coordinator)
- checkInFlow, planningFlow, rebuildFlow (new flow slices)
- recurring, tags, timeBlocks
  </action>
  <verify>TypeScript check: `cd /home/kamil/Code/dumpday/frontend && npx tsc --noEmit 2>&1 | grep -E "index.ts|error" | head -10`</verify>
  <done>store/index.ts updated with new slice imports and reducer configuration</done>
</task>

<task type="auto">
  <name>Task 2a: Update dailyNoteSlice cross-slice import</name>
  <files>frontend/src/store/dailyNoteSlice.ts</files>
  <action>
Update dailyNoteSlice.ts cross-slice dependency:

**CRITICAL - cross-slice dependency:**
- Change line 4 from:
  `import { performTaskAction } from './howAreYouSlice';`
  to:
  `import { performTaskAction } from './checkInFlowSlice';`
  </action>
  <verify>
1. Check import update: `grep -n "checkInFlowSlice" /home/kamil/Code/dumpday/frontend/src/store/dailyNoteSlice.ts`
2. TypeScript check: `cd /home/kamil/Code/dumpday/frontend && npx tsc --noEmit 2>&1 | grep dailyNoteSlice`
  </verify>
  <done>dailyNoteSlice uses checkInFlowSlice for performTaskAction</done>
</task>

<task type="auto">
  <name>Task 2b: Update how-are-you flow component imports</name>
  <files>
    frontend/src/components/how-are-you/CheckInFlow.tsx
    frontend/src/components/how-are-you/PlanningFlow.tsx
    frontend/src/components/how-are-you/RebuildFlow.tsx
  </files>
  <action>
Update imports in how-are-you flow components:

**1. CheckInFlow.tsx:**
- Keep imports from howAreYouSlice: backToSelection, closeModal
- Move to checkInFlowSlice: fetchCheckInTasks, performTaskAction, completeCheckIn, nextTask (was nextCheckInTask), incrementCombo, resetCombo, incrementStat

Updated imports:
```typescript
import {
  backToSelection,
  closeModal,
} from '@/store/howAreYouSlice';
import {
  fetchCheckInTasks,
  performTaskAction,
  completeCheckIn,
  nextTask,
  incrementCombo,
  resetCombo,
  incrementStat,
} from '@/store/checkInFlowSlice';
```

- Update selector: `state.howAreYou.checkIn` -> `state.checkInFlow`
- Keep error selector: `state.howAreYou.error` (still on coordinator)

**2. PlanningFlow.tsx:**
- Keep imports from howAreYouSlice: backToSelection, closeModal
- Move to planningFlowSlice: fetchPlanningTasks, nextStep (was nextPlanningStep), previousStep (was previousPlanningStep), nextTask (was nextPlanningTask), skipTask (was skipPlanningTask), setEstimation, setFixedTime, setCombineEvents, setNeedsFullFocus, markTaskPlanned, generateSchedule, acceptSchedule, savePlanningTask, resolveConflict, nextConflict, finishConflictPhase

Updated imports:
```typescript
import {
  backToSelection,
  closeModal,
} from '@/store/howAreYouSlice';
import {
  fetchPlanningTasks,
  nextStep,
  previousStep,
  nextTask,
  skipTask,
  setEstimation,
  setFixedTime,
  setCombineEvents,
  setNeedsFullFocus,
  markTaskPlanned,
  generateSchedule,
  acceptSchedule,
  savePlanningTask,
  resolveConflict,
  nextConflict,
  finishConflictPhase,
} from '@/store/planningFlowSlice';
```

- Update selector: `state.howAreYou.planning` -> `state.planningFlow`
- Keep error selector: `state.howAreYou.error`

**3. RebuildFlow.tsx:**
- Keep imports from howAreYouSlice: backToSelection, closeModal
- Move to rebuildFlowSlice: fetchRebuildData, setStep (was setRebuildStep), toggleTaskSelection, toggleEventSelection, setAdditionalInput, setWorkUntilTime, generateRebuild, acceptRebuild
- **IMPORTANT:** Update RebuildStep import to come from rebuildFlowSlice (if used as type)

Updated imports:
```typescript
import {
  backToSelection,
  closeModal,
} from '@/store/howAreYouSlice';
import {
  fetchRebuildData,
  setStep,
  toggleTaskSelection,
  toggleEventSelection,
  setAdditionalInput,
  setWorkUntilTime,
  generateRebuild,
  acceptRebuild,
  type RebuildStep,  // if needed
} from '@/store/rebuildFlowSlice';
```

- Update selector: `state.howAreYou.rebuild` -> `state.rebuildFlow`
- Keep error selector: `state.howAreYou.error`
  </action>
  <verify>
1. TypeScript check: `cd /home/kamil/Code/dumpday/frontend && npx tsc --noEmit 2>&1 | grep -E "Flow.tsx|error" | head -20`
2. Selector path check: `grep -r "state.howAreYou.checkIn\|state.howAreYou.planning\|state.howAreYou.rebuild" /home/kamil/Code/dumpday/frontend/src/` should return no matches
  </verify>
  <done>All how-are-you flow components use their respective flow slices</done>
</task>

<task type="auto">
  <name>Task 3: Update or delete old modal components and their imports</name>
  <files>
    frontend/src/components/check-in/CheckInModal.tsx
    frontend/src/components/planning/PlanningModal.tsx
    frontend/src/hooks/useAutoCheckIn.ts
  </files>
  <action>
Handle components that currently import from the old checkInSlice and planningSlice (which will be deleted):

**1. Analyze current usage:**
- CheckInModal.tsx imports from @/store/checkInSlice
- PlanningModal.tsx imports from @/store/planningSlice
- useAutoCheckIn.ts imports from @/store/checkInSlice

**2. Determine if these components are used:**
- Search for imports: `grep -r "CheckInModal\|PlanningModal" frontend/src/`
- If NOT imported anywhere, delete the files
- If imported, update to use new flow slices

**3. For CheckInModal.tsx (if kept):**
Update imports from checkInSlice to checkInFlowSlice:
- openCheckIn -> dispatching selectMode('checkin') + openModal from howAreYouSlice
- fetchCheckInTasks -> from checkInFlowSlice
- Other actions -> from checkInFlowSlice
- Update selectors: state.checkIn -> state.checkInFlow

**4. For PlanningModal.tsx (if kept):**
Update imports from planningSlice to planningFlowSlice:
- Update all action imports to use planningFlowSlice
- Update selectors: state.planning -> state.planningFlow

**5. For useAutoCheckIn.ts:**
Update imports:
- openCheckIn -> openModal from howAreYouSlice
- fetchCheckInTasks -> from checkInFlowSlice
- Update any selectors if present

**DECISION POINT:** If these components duplicate functionality in how-are-you/ components, delete them. The HowAreYouModal is the main interface.
  </action>
  <verify>
1. No dangling imports to old slices: `grep -r "from.*checkInSlice\|from.*planningSlice" /home/kamil/Code/dumpday/frontend/src/ 2>/dev/null | wc -l` should be 0
2. TypeScript check: `cd /home/kamil/Code/dumpday/frontend && npx tsc --noEmit 2>&1 | grep -E "Modal|useAuto|error" | head -10`
  </verify>
  <done>Old modal components either updated to new slices or deleted, no dangling imports remain</done>
</task>

<task type="auto">
  <name>Task 4: Remove RebuildStep from howAreYouSlice and delete unused slices</name>
  <files>
    frontend/src/store/howAreYouSlice.ts
    frontend/src/store/checkInSlice.ts (delete)
    frontend/src/store/planningSlice.ts (delete)
  </files>
  <action>
1. **Remove temporary RebuildStep export from howAreYouSlice:**
   - Remove: `export type RebuildStep = ...`
   - This type is now exported from rebuildFlowSlice
   - Verify no remaining imports from howAreYouSlice for RebuildStep

2. **Delete unused duplicate slices:**
   - rm frontend/src/store/checkInSlice.ts
   - rm frontend/src/store/planningSlice.ts

3. **Search for any remaining references and confirm none:**
   - grep -r "checkInSlice" frontend/src/
   - grep -r "planningSlice" frontend/src/
   - Should return 0 matches (except possibly comments)

4. **Run full build to verify:**
   - cd frontend && npm run build
  </action>
  <verify>
1. RebuildStep not in howAreYouSlice: `grep "export type RebuildStep" /home/kamil/Code/dumpday/frontend/src/store/howAreYouSlice.ts` should return empty
2. Files deleted: `ls /home/kamil/Code/dumpday/frontend/src/store/checkInSlice.ts 2>&1` should show "No such file"
3. No dangling imports: `grep -r "from.*checkInSlice\|from.*planningSlice" /home/kamil/Code/dumpday/frontend/src/ 2>/dev/null | wc -l` should be 0
4. Build succeeds: `cd /home/kamil/Code/dumpday/frontend && npm run build 2>&1 | tail -5`
  </verify>
  <done>Unused slices deleted, RebuildStep export removed from howAreYouSlice, no dangling imports, build passes</done>
</task>

</tasks>

<verification>
1. `npm run build` in frontend completes successfully
2. `grep -r "performTaskAction" frontend/src/store/dailyNoteSlice.ts` shows import from checkInFlowSlice
3. No references to deleted checkInSlice.ts or planningSlice.ts remain
4. No old selector paths remain: `grep -r "state.howAreYou.checkIn\|state.howAreYou.planning\|state.howAreYou.rebuild" frontend/src/` returns no matches
5. RootState type includes checkInFlow, planningFlow, rebuildFlow keys
</verification>

<success_criteria>
- Store configured with new flow slices
- dailyNoteSlice cross-slice dependency updated
- All flow components use new slice imports
- Old modal components updated or deleted
- Unused duplicate slices deleted
- RebuildStep only exported from rebuildFlowSlice
- Frontend builds successfully
- Manual testing: CheckIn, Planning, Rebuild flows all work
</success_criteria>

<output>
After completion, create `.planning/phases/12-frontend-slices/12-03-SUMMARY.md`
</output>
