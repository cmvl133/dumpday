---
phase: 12-frontend-slices
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/store/howAreYouSlice.ts
  - frontend/src/store/checkInFlowSlice.ts
autonomous: true

must_haves:
  truths:
    - "Coordinator slice manages only modal/mode state (~50 lines)"
    - "CheckIn flow state managed in dedicated slice"
    - "Task actions in check-in still sync with main task list"
  artifacts:
    - path: "frontend/src/store/howAreYouSlice.ts"
      provides: "Thin coordinator slice with modal state"
      max_lines: 80
    - path: "frontend/src/store/checkInFlowSlice.ts"
      provides: "CheckIn flow slice with thunks"
      exports: ["fetchCheckInTasks", "performTaskAction", "completeCheckIn"]
  key_links:
    - from: "frontend/src/store/checkInFlowSlice.ts"
      to: "frontend/src/store/howAreYouSlice.ts"
      via: "imports selectMode, closeModal for extraReducers"
      pattern: "import.*from.*howAreYouSlice"
---

<objective>
Create coordinator slice and checkInFlowSlice from monolithic howAreYouSlice.

Purpose: Separate modal coordination from flow-specific state to reduce slice complexity and enable focused maintenance.

Output:
- Thin howAreYouSlice (~50 lines) with only modal/mode state
- checkInFlowSlice (~150 lines) with CheckIn state, thunks, and reducers
- performTaskAction exported for dailyNoteSlice cross-slice dependency
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-frontend-slices/12-RESEARCH.md

@frontend/src/store/howAreYouSlice.ts
@frontend/src/store/dailyNoteSlice.ts (lines 1-10, 554-580 for cross-slice dependency)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create checkInFlowSlice with state and thunks</name>
  <files>frontend/src/store/checkInFlowSlice.ts</files>
  <action>
Create new file `checkInFlowSlice.ts` extracting CheckIn functionality from howAreYouSlice:

1. Import dependencies:
   - createSlice, createAsyncThunk, PayloadAction from @reduxjs/toolkit
   - api from @/lib/api
   - selectMode, closeModal from ./howAreYouSlice (for extraReducers)
   - Types: CheckInTask, CheckInStats from @/types

2. Define CheckInFlowState interface:
   - tasks: { overdue: CheckInTask[]; today: CheckInTask[] }
   - currentIndex: number
   - combo: number
   - bestCombo: number
   - stats: CheckInStats
   - isLoading: boolean
   - lastCheckInAt: string | null (add for sync with API)
   - error: string | null (flow-specific error)

3. Create thunks with NEW action type prefixes:
   - fetchCheckInTasks: 'checkInFlow/fetchTasks' (was 'howAreYou/fetchCheckInTasks')
   - performTaskAction: 'checkInFlow/taskAction' (was 'howAreYou/taskAction')
   - completeCheckIn: 'checkInFlow/complete' (was 'howAreYou/completeCheckIn')

4. Create slice with reducers:
   - nextTask (was nextCheckInTask)
   - incrementCombo
   - resetCombo
   - incrementStat
   - clearError

5. Add extraReducers:
   - selectMode: Reset state when mode === 'checkin'
   - closeModal: Optionally clear state
   - Handle all thunk pending/fulfilled/rejected cases
   - Copy lastCheckInAt sync logic from howAreYouSlice

6. Export thunks (especially performTaskAction - critical for dailyNoteSlice)
7. Export actions
8. Export default reducer
  </action>
  <verify>File created with no TypeScript errors: `cd /home/kamil/Code/dumpday/frontend && npx tsc --noEmit 2>&1 | grep -E "checkInFlowSlice|error" | head -20`</verify>
  <done>checkInFlowSlice.ts exists with performTaskAction thunk and all CheckIn state management</done>
</task>

<task type="auto">
  <name>Task 2: Reduce howAreYouSlice to coordinator (keep RebuildStep temporarily)</name>
  <files>frontend/src/store/howAreYouSlice.ts</files>
  <action>
Rewrite howAreYouSlice.ts to be a thin coordinator (~50-80 lines):

1. Keep ONLY modal/mode state:
   - localStorage helpers (getStoredLastModal, storeLastModal)
   - ModalMode type export
   - HowAreYouState interface with ONLY: isOpen, mode, lastModalAt, error

2. Remove all CheckIn, Planning, Rebuild nested state
3. Remove all flow-specific thunks (move to flow slices)

4. **IMPORTANT: Keep RebuildStep type export temporarily**
   - Keep: `export type RebuildStep = 'whats_happening' | 'anything_else' | 'work_until' | 'preview';`
   - This prevents breaking components before Plan 02 creates rebuildFlowSlice
   - Will be removed in Plan 03 after Plan 02 re-exports it from rebuildFlowSlice

5. Remove PlanningStep, PlanningPhase types (Plan 02 will define them locally)

6. Keep ONLY these reducers:
   - openModal
   - closeModal
   - selectMode
   - backToSelection
   - setError
   - clearError

7. Remove extraReducers entirely (flows handle their own thunks)

8. Export:
   - ModalMode type
   - RebuildStep type (temporary - for backward compatibility until Plan 03)
   - openModal, closeModal, selectMode, backToSelection, setError, clearError actions
   - default reducer

Target: ~50-80 lines total (was 583 lines)
  </action>
  <verify>
1. File size check: `wc -l /home/kamil/Code/dumpday/frontend/src/store/howAreYouSlice.ts` should show under 100 lines
2. RebuildStep still exported: `grep "export type RebuildStep" /home/kamil/Code/dumpday/frontend/src/store/howAreYouSlice.ts`
3. TypeScript check: `cd /home/kamil/Code/dumpday/frontend && npx tsc --noEmit 2>&1 | grep howAreYouSlice`
  </verify>
  <done>howAreYouSlice.ts reduced to coordinator with only modal/mode state, under 100 lines, RebuildStep still exported for backward compatibility</done>
</task>

</tasks>

<verification>
1. Both files compile without TypeScript errors
2. howAreYouSlice.ts is under 100 lines
3. checkInFlowSlice.ts exports performTaskAction thunk
4. No circular import between howAreYouSlice and checkInFlowSlice
5. RebuildStep is still exported from howAreYouSlice (temporary backward compatibility)
</verification>

<success_criteria>
- howAreYouSlice.ts: Only modal/mode state (~50-80 lines)
- checkInFlowSlice.ts: Complete CheckIn state management (~150 lines)
- performTaskAction thunk available for dailyNoteSlice import update (Plan 03)
- RebuildStep type still exported (prevents intermediate broken state)
- Both files pass TypeScript compilation
</success_criteria>

<output>
After completion, create `.planning/phases/12-frontend-slices/12-01-SUMMARY.md`
</output>
